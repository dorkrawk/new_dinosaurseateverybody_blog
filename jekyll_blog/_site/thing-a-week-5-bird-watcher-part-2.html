<h2 class="post_title">Thing A Week 5 - Bird Watcher (Part 2)</h2>
<div class="post_date">February 9, 2014</div>

<div class="post">
<p>So I took this week to wrap up last week&#39;s project. I was having trouble getting the Twitter listener for my wedding photo project up and running on my server but I&#39;m pleased to report that I managed to get things up and running.</p>

<p>I ended up changing the format of the project a bit. Instead of a full Sinatra application I put everything into a single Ruby file that I can just leave running whenever I want to fire up the listener. I didn&#39;t need this project to serve any content, only run Tweet Stream and write to a database, so Sinatra was probably overkill to begin with.</p>

<p>I had some trouble with <a href="http://sequel.jeremyevans.net/">Sequel</a>, the Gem I was using to interface with the Postgres database but eventually got things worked out. The weirdest issue was with trying to store the url of the photo.  For some reason this didn&#39;t work:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">store_image</span><span class="p">(</span><span class="n">tweet_photo_url</span><span class="p">,</span> <span class="n">tweet_user</span><span class="p">,</span> <span class="n">tweet_text</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>
  <span class="vi">@db</span><span class="p">[</span><span class="ss">:photos</span><span class="p">].</span><span class="nf">insert</span><span class="p">(</span> <span class="ss">:photo_url</span> <span class="o">=&gt;</span> <span class="n">tweet_photo_url</span><span class="p">,</span> <span class="ss">:service</span> <span class="o">=&gt;</span> <span class="s2">"twitter"</span><span class="p">,</span> <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">screen_name</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span><span class="p">,</span> <span class="ss">:photo_text</span> <span class="o">=&gt;</span> <span class="n">tweet_text</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>but this did:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">store_image</span><span class="p">(</span><span class="n">tweet_photo_url</span><span class="p">,</span> <span class="n">tweet_user</span><span class="p">,</span> <span class="n">tweet_text</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">the_url</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">tweet_photo_url</span><span class="si">}</span><span class="s2">"</span>
  
  <span class="vi">@db</span><span class="p">[</span><span class="ss">:photos</span><span class="p">].</span><span class="nf">insert</span><span class="p">(</span> <span class="ss">:photo_url</span> <span class="o">=&gt;</span> <span class="n">the_url</span><span class="p">,</span> <span class="ss">:service</span> <span class="o">=&gt;</span> <span class="s2">"twitter"</span><span class="p">,</span> <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">screen_name</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span><span class="p">,</span> <span class="ss">:photo_text</span> <span class="o">=&gt;</span> <span class="n">tweet_text</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>It must have something to do with the way Ruby handles certain strings or how Sequel or Postgres handle certain strings in INSERTs.</p>

<p>You can see the final file I&#39;m using <code>bird_watcher.rb</code> in the <a href="https://github.com/dorkrawk/bird-watcher">Github repo</a> for the project.  </p>

<p>Next I&#39;ll need to write an Instragram listener. Hopefully that will be pretty quick as most of the mechanics will be identical to this listener. I might hold off on working on that for a bit, though. I&#39;m thinking about tackling a musical project next week.</p>

</div>

<div class="back_to_blog"><a href="../blog"><i class="icon-arrow-left"></i> back to blog</a></div>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'dinosaurseateverybody'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>    

